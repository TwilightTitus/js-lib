de.titus.core.Namespace.create("de.titus.TemplateEngine", function() {
	
	/**
	 * @param aTemplate
	 *            The definition to template
	 */
	de.titus.TemplateEngine = /* constructor */function(aDomHelper, aTargetElement, theSettings) {
		this.domHelper = aDomHelper || theSettings.domHelper || de.titus.utils.DomHelper.getInstance();
		this.settings = new de.titus.TemplateEngineSettings(aTargetElement, this.domHelper);
		if (theSettings != undefined) {
			this.settings = this.domHelper.mergeObjects(this.settings, theSettings);
		}
		this.settings.initialize();
		
		this.$target = this.domHelper.toDomObject(aTargetElement);
		this.$template;
		this.data;
		this.options;
		
		this.isTemplateInit = false;
		this.isDataInit = false;
		this.isOptionInit = false;
	};
	
	de.titus.TemplateEngine.GLOBAL_VARIABLEN_REGEX = /\$\{([^\$\\{\}]*)\}/;
	de.titus.TemplateEngine.GLOBAL_ISFUNCTION_REGEX = /([^\(\)]*)(\([^\(\)]*\);?)/;
	
	de.titus.TemplateEngine.prototype.doTemplating = /* string */function() {
		var this_ = this;
		window.setTimeout(function() {
			this_.initTemplate();
			this_.initData();
			this_.initOptions();
			this_.doRendering();
		}, 1);
	};
	
	/**********************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************
	 * init the Template definition
	 *********************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************/
	de.titus.TemplateEngine.prototype.initTemplate = /* void */function() {
		if (this.settings.templateMode == "id") {
			this.loadTemplateById();
		} else if (this.settings.templateMode == "remote") {
			this.loadTemplateByRemote();
		} else if (this.settings.templateMode == "function") {
			this.loadTemplateByFunction();
		} else {
			throw "there is no template mode defined!";
		}
	};
	
	de.titus.TemplateEngine.prototype.loadTemplateById = function() {
		var template = this.domHelper.getDomElementById(this.settings.template);
		var template = this.domHelper.getText(template);
		this.$template = this.domHelper.toDomObject(template);
		this.isTemplateInit = true;
	};
	
	de.titus.TemplateEngine.prototype.loadTemplateByRemote = function() {
		var this_ = this;
		var ajaxSettings = {
		'url' : this.settings.template,
		'async' : this.settings.templateAsync,
		'cache' : false };
		ajaxSettings = this.domHelper.mergeObjects(ajaxSettings, this.settings.templateRemoteData);
		this.domHelper.doRemoteLoadHtml(ajaxSettings, function(template) {
			this_.$template = this_.domHelper.toDomObject(template);
			this_.isTemplateInit = true;
		});
	};
	
	de.titus.TemplateEngine.prototype.loadTemplateByFunction = function() {
		if (this.settings.templateAsync) {
			var this_ = this;
			window.setTimeout(function() {
				var template = eval(this_.settings.template);
				this_.$template = this_.domHelper.toDomObject(template);
				this_.isTemplateInit = true;
			}, 1);
		} else {
			var template = eval(this.settings.template);
			this.$template = this.domHelper.toDomObject(template);
			this.isTemplateInit = true;
		}
	};
	
	/**********************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************
	 * init the content data
	 *********************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************/
	de.titus.TemplateEngine.prototype.initData = /* void */function() {
		if (this.settings.dataMode == "direct") {
			this.loadDataByDirect();
		} else if (this.settings.dataMode == "remote") {
			this.loadDataByRemote();
		} else if (this.settings.dataMode == "function") {
			this.loadDataByFunction();
		} else {
			throw "there is no template mode defined!";
		}
	};
	
	de.titus.TemplateEngine.prototype.loadDataByDirect = function() {
		this.data = this.settings.data || {};
		this.isDataInit = true;
	};
	
	de.titus.TemplateEngine.prototype.loadDataByRemote = function() {
		var this_ = this;
		var ajaxSettings = {
		'url' : this.settings.data,
		'async' : this.settings.dataAsync,
		'cache' : false };
		ajaxSettings = this.domHelper.mergeObjects(ajaxSettings, this.settings.dataRemoteData);
		this.domHelper.doRemoteLoadJson(ajaxSettings, function(data) {
			console.log(data);
			this_.data = data;
			this_.isDataInit = true;
		});
	};
	
	de.titus.TemplateEngine.prototype.loadDataByFunction = function() {
		if (this.settings.dataAsync) {
			var this_ = this;
			window.setTimeout(function() {
				this_.data = eval(this_.settings.data);
				this_.isDataInit = true;
			}, 1);
		} else {
			this.data = eval(this.settings.data);
			this.isDataInit = true;
		}
	};
	
	/**
	 * 
	 */
	de.titus.TemplateEngine.prototype.initOptions = /* void */function() {
		// TODO implements
		this.options = this.settings.options || {};
		this.isOptionInit = true;
	};
	
	/**
	 * 
	 */
	de.titus.TemplateEngine.prototype.doRendering = /* string */function() {
		if (this.isTemplateInit && this.isDataInit && this.isOptionInit) {
			this.domHelper.doRemoveChilds(this.$target);
			if (this.domHelper.isArray(this.data)) {
				for (var i = 0; i < this.data.length; i++) {
					this.internalRendering(this.data[i], this.options);
				}
			} else {
				this.internalRendering(this.data, this.options);
			}
		} else {
			var this_ = this;
			window.setTimeout(function() {
				this_.doRendering();
			}, 10);
		}
	};
	
	/**
	 * 
	 * @param theData
	 * @param theOptions
	 */
	de.titus.TemplateEngine.prototype.internalRendering = function(theData, theOptions) {
		var content = this.domHelper.cloneDomObject(this.$template);
		content = this.domHelper.toDomObject(content);
		this.processing(content, theData, theOptions);
		this.domHelper.setHtml(this.$target, content, "append");
	};
	
	/**
	 * 
	 * @param aElement
	 * @param theData
	 * @param theOptions
	 * @returns
	 */
	de.titus.TemplateEngine.prototype.processing = function(aElement, theData, theOptions) {
		if (this.processDirectives(aElement, theData, theOptions)) {
			var childs = this.domHelper.getChilds(aElement);
			if (childs != undefined) {
				for (var i = 0; i < childs.length; i++) {
					var child = this.domHelper.toDomObject(childs[i]);
					this.processing(child, theData, theOptions);
				}
			}
		}
	};
	
	/**
	 * 
	 * @param aElement
	 * @param theData
	 * @param theOptions
	 * @returns true, if the complety processed
	 */
	de.titus.TemplateEngine.prototype.processDirectives = function(aElement, theData, theOptions) {
		var result = true;
		result = result && this.processIfDirective(aElement, theData, theOptions);
		result = result && this.processChooseDirective(aElement, theData, theOptions);
		result = result && this.processTemplateReference(aElement, theData, theOptions);
		result = result && this.processForeachDirective(aElement, theData, theOptions);
		result = result && this.processContent(aElement, theData, theOptions);
		
		return result;
	};
	
	/**
	 * 
	 * @param aElement
	 * @param theData
	 * @param theOptions
	 * @returns {String}
	 */
	de.titus.TemplateEngine.prototype.processTemplateReference = function(aElement, theData, theOptions) {
		var definition = this.domHelper.getAttribute(aElement, this.settings.attributePrefix + 'template') || this.domHelper.getAttribute(aElement, this.settings.attributePrefix + 'template-remote') || this.domHelper.getAttribute(aElement, this.settings.attributePrefix + 'template-function');
		if (definition != undefined && definition.length != 0) {
			
			var executeTemplate = this.domHelper.getAttribute(aElement, this.settings.attributePrefix + 'template-execute') || true;
			if (executeTemplate != undefined) {
				executeTemplate = this.evalVariable(executeTemplate, aElement, theData, theOptions, true);
			}
			
			this.domHelper.doRemoveChilds(aElement);
			/*
			 * <code>var settings; var remoteData = this.domHelper.getAttribute(aElement, this.settings.attributePrefix + 'template-data-remote'); var data = theData; if(remoteData != undefined && de.titus.TemplateEngine.GLOBAL_VARIABLEN_REGEX.test(remoteData)){ var match = de.titus.TemplateEngine.GLOBAL_VARIABLEN_REGEX.exec(remoteData); data = this.evalVariable(match[1], aElement, theData, theOptions); settings.data = {}; settings.data = data; }</code>
			 */

			this.processAttributes(aElement, theData, theOptions, true);
			if (executeTemplate == true) {
				var templateEngine = new de.titus.TemplateEngine(this.domHelper, aElement);
				var data = theData || {};
				data = this.domHelper.mergeObjects(data, templateEngine.settings);
				templateEngine.settings = data;
				templateEngine.doTemplating();
			}
		}
		
		return true;
	};
	
	/**
	 * 
	 * @param aElement
	 * @param theData
	 * @param theOptions
	 * @returns {Boolean}
	 */
	de.titus.TemplateEngine.prototype.processChooseDirective = function(aElement, theData, theOptions) {
		var expression = this.domHelper.getAttribute(aElement, this.settings.attributePrefix + 'choose');
		
		if (expression != undefined) {
			var childs = this.domHelper.getChilds(aElement);
			var elseElement;
			var removeOthers = false;
			for (var i = 0; i < childs.length; i++) {
				var child = this.domHelper.toDomObject(childs[i]);
				if (!removeOthers) {
					var elseExpression = this.domHelper.getAttribute(child, this.settings.attributePrefix + 'else');
					var ifExpression = this.domHelper.getAttribute(child, this.settings.attributePrefix + 'if')
					if (elseElement == undefined && elseExpression != undefined) {
						elseElement = child;
					} else if (ifExpression != undefined && this.processIfDirective(child, theData, theOptions)) {
						this.domHelper.setAttribute(child, this.settings.attributePrefix + 'if')
						removeOthers = true;
					} else {
						this.domHelper.doRemove(child);
					}
				} else
					this.domHelper.doRemove(child);
			}
			
			if (removeOthers && elseElement != undefined)
				this.domHelper.doRemove(otherwiseElement);
		}
		return true;
	};
	
	/**
	 * 
	 * @param aElement
	 * @param theData
	 * @param theOptions
	 * @returns {Boolean}
	 */
	de.titus.TemplateEngine.prototype.processIfDirective = function(aElement, theData, theOptions) {
		var expression = this.domHelper.getAttribute(aElement, this.settings.attributePrefix + 'if');
		this.domHelper.setAttribute(aElement, this.settings.attributePrefix + 'if');
		
		var defaultValue = this.domHelper.getAttribute(aElement, this.settings.attributePrefix + 'if-default');
		if (expression != undefined) {
			var match = de.titus.TemplateEngine.GLOBAL_VARIABLEN_REGEX.exec(expression);
			var result = this.evalVariable(match[1], aElement, theData, theOptions, defaultValue);
			if (result != true) {
				this.domHelper.doRemove(aElement);
				return false;
			}
		}
		
		return true;
	};
	
	de.titus.TemplateEngine.prototype.processForeachDirective = function(aElement, theData, theOptions) {
		var expression = this.domHelper.getAttribute(aElement, this.settings.attributePrefix + 'foreach');
		this.domHelper.setAttribute(aElement, this.settings.attributePrefix + 'foreach');
		
		if (expression != undefined && expression.length != 0) {
			var match = de.titus.TemplateEngine.GLOBAL_VARIABLEN_REGEX.exec(expression);
			var result = this.evalVariable(match[1], aElement, theData, theOptions);
			
			if (this.domHelper.isArray(result)) {
				
				var varName = this.domHelper.getAttribute(aElement, this.settings.attributePrefix + 'foreach-var-item') || "item";
				var statusName = this.domHelper.getAttribute(aElement, this.settings.attributePrefix + 'foreach-var-status') || "status";
				var repeatContent = this.domHelper.getAttribute(aElement, this.settings.attributePrefix + 'foreach-repeat-content') || false;
				repeatContent = this.domHelper.doEval(repeatContent, false);
				
				var baseElement;
				var templates;
				if (repeatContent) {
					baseElement = aElement;
					var childs = this.domHelper.getChilds(aElement);
					templates = this.convertToTemplate(childs);
					this.domHelper.doRemove(childs);
					
				} else {
					baseElement = this.domHelper.getParent(aElement);
					templates = this.convertToTemplate(aElement);
					this.domHelper.doRemove(aElement);
				}
				
				for (var i = 0; i < result.length; i++) {
					var status = {
					"index" : i,
					"number" : (i + 1),
					"count" : result.length,
					"list" : result };
					var data = {};
					data[varName] = result[i];
					data[statusName] = status;
					
					this.processForeachTemplates(baseElement, templates, data, theOptions);
				}
			}
			
			return false;
		} else {
			// there is no foreach directiv avalible
			return true;
		}
	};
	
	/**
	 * 
	 * @param aElement
	 * @returns {Array}
	 */
	de.titus.TemplateEngine.prototype.convertToTemplate = function(aElement) {
		var templates = new Array();
		if (this.domHelper.isArray(aElement)) {
			for (var i = 0; i < aElement.length; i++) {
				templates.push(this.domHelper.toDomObject(aElement[i]));
			}
		} else {
			templates.push(this.domHelper.toDomObject(aElement));
		}
		
		return templates;
	};
	
	/**
	 * 
	 * @param aElement
	 * @param theChilds
	 * @param theData
	 * @param theOptions
	 */
	de.titus.TemplateEngine.prototype.processForeachTemplates = function(aElement, theTemplates, theData, theOptions) {
		for (var i = 0; i < theTemplates.length; i++) {
			var content = this.domHelper.cloneDomObject(theTemplates[i]);
			content = this.domHelper.toDomObject(content);
			this.domHelper.setHtml(aElement, content, "append");
			this.processing(content, theData, theOptions);
			
		}
	};
	
	/**
	 * 
	 * @param aElement
	 * @param theData
	 * @param theOptions
	 * @returns {String}
	 */
	de.titus.TemplateEngine.prototype.processContent = function(aElement, theData, theOptions) {
		
		if (this.domHelper.getChildCount(aElement) == 0) {
			var content = this.domHelper.getText(aElement);
			content = this.evalText(content, aElement, theData, theOptions);
			
			this.domHelper.setHtml(aElement, content);
			this.processAttributes(aElement, theData, theOptions);
			return false;
		}
		
		this.processAttributes(aElement, theData, theOptions);
		return true;
	};
	
	/**
	 * 
	 * @param aElement
	 * @param theData
	 * @param theOptions
	 */
	de.titus.TemplateEngine.prototype.processAttributes = function(aElement, theData, theOptions, all) {
		var attributes = this.domHelper.getAttributes(aElement);
		var processAll = all || false;
		for ( var name in attributes) {
			if (processAll || this.settings.attributePrefix == undefined || this.settings.attributePrefix.lenght == 0 || name.indexOf(this.settings.attributePrefix) != 0) {
				var value = attributes[name];
				value = this.evalText(value, aElement, theData, theOptions);
				this.domHelper.setAttribute(aElement, name, value);
			}
		}
	};
	/**
	 * 
	 * @param aText
	 * @param aElement
	 * @param theData
	 * @param theOptions
	 * @returns
	 */
	de.titus.TemplateEngine.prototype.evalText = function(aText, aElement, theData, theOptions) {
		var content = aText;
		while (de.titus.TemplateEngine.GLOBAL_VARIABLEN_REGEX.test(content)) {
			var match = de.titus.TemplateEngine.GLOBAL_VARIABLEN_REGEX.exec(content);
			var result = this.evalVariable(match[1], aElement, theData, theOptions);
			if (result != undefined) {
				content = content.replace(match[0], result);
			}
		}
		
		return content;
	}

	/**
	 * 
	 * @param aVariable
	 * @param aElement
	 * @param theData
	 * @param theOptions
	 * 
	 * @returns returns the value of "aVariable"
	 */
	de.titus.TemplateEngine.prototype.evalVariable = function(aVariable, aElement, theData, theOptions, aDefaultValue) {
		var dataFormatter = this.domHelper.getAttribute(aElement, this.settings.attributePrefix + 'formatter');
		var undefinedValue = this.domHelper.getAttribute(aElement, this.settings.attributePrefix + 'undefined-value');
		
		var data = theData || {};
		var variable = aVariable;
		if (de.titus.TemplateEngine.GLOBAL_ISFUNCTION_REGEX.test(aVariable)) {
			var functionMatch = de.titus.TemplateEngine.GLOBAL_ISFUNCTION_REGEX.exec(aVariable);
			variable = functionMatch[1];
		}
		
		var result = this.domHelper.doEvalWithContext(variable, data);
		if (this.domHelper.isFunction(result)) {
			result = result(data);
		}
		
		if (dataFormatter != undefined) {
			var formatFunction = this.domHelper.doEvalWithContext(variable, data);
			if (formatFunction != undefined && this.domHelper.isFunction(formatFunction)) {
				result = formatFunction(result);
			}
		}
		if (result == undefined && undefinedValue == undefined) {
			return aDefaultValue;
		} else if (result == undefined && undefinedValue != undefined) {
			return undefinedValue;
		} else {
			return result;
		}
	};
	
});
de.titus.core.Namespace.create("de.titus.TemplateEngineSettings", function(){

	de.titus.TemplateEngineSettings = /* constructor */function(aTargetElement, aDomHelper) {
		this.domHelper = aDomHelper || de.titus.utils.DomHelper.getInstance();
		this.target = this.domHelper.toDomObject(aTargetElement);

		this.template;
		this.templateMode = 'id'; // id, remote, function
		this.templateAsync = true;
		this.templateRemoteData = {};

		this.data;
		this.dataMode = 'direct'; // direct, remote, function
		this.dataAsync = true;
		this.dataRemoteData = {};

		this.options;
		this.optionsMode = 'direct'; // direct, remote, function
		this.optionsAsync = true;
		this.optionsRemoteData = {};

		this.onLoad = function() {
		};
		this.onSuccess = function() {
		};
		this.onError = function() {
		};
		
		this.attributePrefix = "tpl-";
	};

	/**
	 * Initialize all required settings.
	 *
	 * @param theOverrideSettings
	 */
	de.titus.TemplateEngineSettings.prototype.initialize = function() {

		this.templateRemoteData = this.domHelper.doEval(this.domHelper.getAttribute(this.target, this.attributePrefix +'template-remote-data'), {});
		this.dataRemoteData = this.domHelper.doEval(this.domHelper.getAttribute(this.target, this.attributePrefix+'template-data-remote-data'), {})
		this.optionsRemoteData = this.domHelper.doEval(this.domHelper.getAttribute(this.target, this.attributePrefix + 'template-options-remote-data'), {})
		this.initTemplateSettings();
		this.initDataSettings();
		this.initOptionsSettings();
	};

	/**
	 * Initialize the settings for the template
	 */
	de.titus.TemplateEngineSettings.prototype.initTemplateSettings = function() {
		if (this.template != undefined) {
			return;
		} else if (this.domHelper.getAttribute(this.target, this.attributePrefix + 'template') != undefined) {
			this.template = this.domHelper.doEval(this.domHelper.getAttribute(this.target, this.attributePrefix + 'template'));
			this.templateMode = 'id';
		} else if (this.domHelper.getAttribute(this.target, this.attributePrefix + 'template-remote') != undefined) {
			this.template = this.domHelper.getAttribute(this.target, this.attributePrefix + 'template-remote');
			this.templateMode = 'remote';
		} else if (this.domHelper.getAttribute(this.target, this.attributePrefix + 'template-function') != undefined) {
			this.template = this.domHelper.getAttribute(this.target, this.attributePrefix + 'template-function');
			this.templateMode = 'function';
		} else {
			console.log('There is no template definition available!');
		}

	};

	/**
	 * Initialize the settings for the data
	 */
	de.titus.TemplateEngineSettings.prototype.initDataSettings = function() {
		if (this.data != undefined) {
			return;
		} else if (this.domHelper.getAttribute(this.target, this.attributePrefix + 'template-data') != undefined) {
			this.data = this.domHelper.doEval(this.domHelper.getAttribute(this.target, this.attributePrefix + 'template-data'));
			this.dataMode = 'direct';
		} else if (this.domHelper.getAttribute(this.target, this.attributePrefix + 'template-data-remote') != undefined) {
			this.data = this.domHelper.getAttribute(this.target, this.attributePrefix + 'template-data-remote');
			this.dataMode = 'remote';
		} else if (this.domHelper.getAttribute(this.target, this.attributePrefix + 'template-data-function') != undefined) {
			this.data = this.domHelper.getAttribute(this.target, this.attributePrefix + 'template-data-function');
			this.dataMode = 'function';
		} else {
			console.log('There is no data definition available!');
		}
	};

	/**
	 * Initialize the settings for the options
	 */
	de.titus.TemplateEngineSettings.prototype.initOptionsSettings = function() {
		if (this.options != undefined) {
			return;
		} else if (this.domHelper.getAttribute(this.target, this.attributePrefix + 'template-options') != undefined) {
			this.options = this.domHelper.doEval(this.domHelper.getAttribute(this.target, this.attributePrefix + 'template-options'));
			this.optionsMode = 'direct';
		} else if (this.domHelper.getAttribute(this.target, this.attributePrefix + 'template-options-remote') != undefined) {
			this.options = this.domHelper.getAttribute(this.target, this.attributePrefix + 'template-options-remote');
			this.optionsMode = 'remote';
		} else if (this.domHelper.getAttribute(this.target, this.attributePrefix + 'template-options-function') != undefined) {
			this.options = this.domHelper.getAttribute(this.target, this.attributePrefix + 'template-options-function');
			this.optionsMode = 'function';
		} else {
			this.options = {};
		}
	};
});
